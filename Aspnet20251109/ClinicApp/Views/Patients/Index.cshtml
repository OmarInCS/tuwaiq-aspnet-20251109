@model PatientFilteredListVM

<h1>
    Patients
</h1>

<a asp-controller="Patients" asp-action="Register">
    Register
</a>

<form class="row row-cols-lg-auto g-3 align-items-center">
    <div class="form-floating mb-2 col-12">
        <input class="form-control" asp-for="Filter.Id" />
        <label asp-for="Filter.Id"></label>
    </div>
    <div class="form-floating mb-2 col-12">
        <input class="form-control" asp-for="Filter.FullName" />
        <label asp-for="Filter.FullName"></label>
    </div>
    <div class="form-floating mb-2 col-12">
        <input class="form-control" asp-for="Filter.NationalId" />
        <label asp-for="Filter.NationalId"></label>
    </div>
    <div class="col-12">
        <button type="submit" class="btn btn-primary">Submit</button>
    </div>
</form>


<ol>
    @foreach (var p in Model.Patients) {
        <li>
            <a asp-controller="Patients" asp-action="Details" asp-route-id="@p.Id">
                @p.FullName
            </a>
            <a class="btn btn-primary btn-sm ms-5" asp-controller="Patients" asp-action="Update" asp-route-id="@p.Id">
                <i class="bi bi-pencil-square"></i>
            </a>
            <a class="btn btn-danger btn-sm ms-5 js-btn-delete" data-id="@p.Id">
                <i class="bi bi-person-x-fill"></i>
            </a>
        </li>
    }
</ol>

@section Scripts {

    <script>
        $(".js-btn-delete").on("click", function () {
            
            const btn = $(this);
            const id = $(this).data("id");
            const isConfirmed = confirm("Are you sure you want to delete this patient?");

            if (isConfirmed) {
                $.ajax({
                    url: "Patients/Delete/" + id,
                    success: function (result) {
                        btn.parents("li").remove();
                    },
                    error: function (xhr, status, error) {
                        alert("An error occurred while trying to delete the patient: " + error);
                    }
                })
            }
        });
    </script>


}